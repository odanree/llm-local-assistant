# v2.6 File Structure - Quick Reference Card

## TL;DR: Where Does Each Piece Live?

| Component | Location | Files | Purpose |
|-----------|----------|-------|---------|
| **TTS Model** | `python/` | 3 | ChatTTS service + setup |
| **TTS Bridge** | `src/services/` | 1 | Node.js subprocess manager |
| **Audio Player UI** | `webview/components/` | 1 | React audio player |
| **Explanation Panel** | `webview/panels/` | 1 | Modified panel |
| **Styles** | `webview/styles/` | 1 | Audio player CSS |
| **Types** | `src/types/` | 1 | TypeScript interfaces |
| **Commands** | `src/commands/` | 1 | `/explain` with voice |
| **Docs** | `docs/` | 1 | Setup & usage guide |
| **Config** | Root | 2 | package.json, .gitignore |

---

## File Creation Checklist

### Phase 1: Create Python TTS Service

```bash
mkdir -p python

# Create 3 files:
touch python/tts_service.py
touch python/setup_tts.py
touch python/test_tts.py
```

### Phase 2: Create TypeScript Bridge

```bash
# In src/services/
touch src/services/ttsService.ts

# In src/types/
touch src/types/tts.ts

# In src/commands/
mkdir -p src/commands
touch src/commands/index.ts
touch src/commands/explain.ts
```

### Phase 3: Create React Components

```bash
# Already exists (modify existing files):
# webview/components/
# webview/panels/

# Create new files:
touch webview/components/AudioPlayer.tsx
touch webview/styles/audioPlayer.css

# Modify:
# webview/panels/ExplanationPanel.tsx
```

### Phase 4: Create Documentation

```bash
touch docs/VOICE_NARRATION.md
```

### Phase 5: Modify Config Files

```bash
# Edit:
# - src/extension.ts
# - src/services/index.ts
# - src/types/index.ts
# - webview/styles/index.css
# - package.json
# - .gitignore
```

---

## Key Files to Understand

### 1. `src/services/ttsService.ts` - The Bridge

**This is the main integration point.** Everything else connects here.

```typescript
// Usage in any command:
const result = await ttsService.synthesize({
  text: explanation,
  lang: 'en'
});
// Returns: { audioBuffer, sampleRate, duration }
```

### 2. `python/tts_service.py` - The Model

**Handles the heavy lifting.** Runs as subprocess.

```python
service = ChatTTSService()
sample_rate, audio_bytes = service.synthesize("Hello world")
```

### 3. `webview/components/AudioPlayer.tsx` - The UI

**What users interact with.** Controls: play, pause, speed, volume.

```typescript
<AudioPlayer
  audioPath="/path/to/audio.wav"
  duration={5.2}
  sampleRate={24000}
/>
```

### 4. `package.json` - The Config

**Settings users can toggle.**

```json
"llm-assistant.voice.enabled": true
"llm-assistant.voice.speed": 1.0
"llm-assistant.voice.language": "en"
```

---

## Data Flow Simplified

```
User: /explain foo.ts
         ‚Üì
extension.ts
         ‚Üì
src/services/ttsService.ts
         ‚Üì
spawn: python/tts_service.py
         ‚Üì
ChatTTS model.infer()
         ‚Üì
Audio buffer (WAV)
         ‚Üì
webview/components/AudioPlayer.tsx
         ‚Üì
üîä User hears narration
```

---

## Dependencies (What Gets Installed)

### Node.js (npm install)
- Already installed
- TypeScript, webpack, vitest, etc.
- **No new npm packages** for v2.6 ‚úì

### Python (manual setup)
- Python 3.8+ (user must have)
- `pip install ChatTTS numpy torch torchaudio`
- Downloaded by `/setup-voice` command

---

## Import Statements (Copy-Paste)

```typescript
// In extension.ts
import { ttsService } from './services/ttsService';

// In explain.ts
import { TTSOptions, TTSResult } from '../types/tts';

// In ExplanationPanel.tsx
import { AudioPlayer } from './AudioPlayer';
import '../styles/audioPlayer.css';
```

---

## Common Questions

**Q: Where does the audio file get saved?**  
A: `.llm-cache/audio/explain-{timestamp}.wav`  
   (Hidden, in workspace root)

**Q: Can users change the cache location?**  
A: Not in v2.6. Add to v2.7 TODO.

**Q: Do I need to compile Python?**  
A: No. Python is interpreted. Just create .py files.

**Q: What if Python isn't installed?**  
A: `/setup-voice` command will fail with clear error.  
   Show "Install Python 3.8+" message.

**Q: Can I test locally before committing?**  
A: Yes! Run in VS Code:
   ```bash
   npm run compile
   npm test
   # Then press F5 to open dev extension
   ```

**Q: What about Windows support?**  
A: Should work! Python path handling is OS-agnostic.  
   Tested on Mac first, then Windows.

---

## The One File You Always Modify First

**`src/extension.ts`**

This is the "main.ts" of the extension. Everything registers here:
- Commands
- Event listeners
- Settings changes
- Webview messages

When adding voice narration:
1. Register `/setup-voice` command
2. Register `/test-voice` command
3. Modify `/explain` command to call ttsService
4. Send audio metadata to webview

---

## The One File Users See First

**`package.json` ‚Üí contributes ‚Üí commands**

When user opens Command Palette, they search and find:
- "LLM: Setup Voice Narration"
- "LLM: Test Voice Narration"

Make descriptions clear!

---

## Testing Paths

```
After creating files, test:

1. Compile:
   npm run compile
   ‚úì Should have 0 errors
   ‚úì Should create dist/extension.js

2. Unit Tests:
   npm test
   ‚úì ttsService tests pass
   ‚úì AudioPlayer tests pass

3. Extension Tests (in VS Code):
   npm run watch
   Press F5 ‚Üí "Run Extension"
   ‚úì /setup-voice command shows
   ‚úì /test-voice command works
   ‚úì /explain generates audio
```

---

## File Sizes (Estimate)

| File | Lines | Size |
|------|-------|------|
| tts_service.py | 150 | ~5KB |
| setup_tts.py | 50 | ~2KB |
| test_tts.py | 30 | ~1KB |
| ttsService.ts | 200 | ~8KB |
| tts.ts | 50 | ~2KB |
| explain.ts | 80 | ~3KB |
| AudioPlayer.tsx | 150 | ~6KB |
| audioPlayer.css | 100 | ~4KB |
| ExplanationPanel.tsx | 80 | ~3KB |
| docs/VOICE_NARRATION.md | 300 | ~12KB |
| **TOTAL** | **1190** | **~46KB** |

Plus modifications (~10KB) in existing files.

---

## Summary

**Remember:**
- üêç Python code = `python/`
- üîß Bridge code = `src/services/`
- ‚öõÔ∏è React code = `webview/`
- üìö Docs = `docs/`
- ‚öôÔ∏è Config = Root files

**Minimal touch:**
- Only modify `extension.ts` + `package.json` in core
- Everything else is pure addition

**Ready to start?** Begin with `python/tts_service.py` in Phase 1.
